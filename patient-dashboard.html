<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Health enSuite Patient Dashboard</title>
    <!-- Favicon icon -->
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon.png">
    <!-- Pignose Calender -->
    <link href="./plugins/pg-calendar/css/pignose.calendar.min.css" rel="stylesheet">
    <!-- Chartist -->
    <link rel="stylesheet" href="./plugins/chartist/css/chartist.min.css">
    <link rel="stylesheet" href="./plugins/chartist-plugin-tooltips/css/chartist-plugin-tooltip.css">
    <!-- Custom Stylesheet -->
    <link href="css/style.css" rel="stylesheet">
    <link href="./plugins/sweetalert/css/sweetalert.css" rel="stylesheet">

    <script language="javascript">

                    window.onload = function getPatientsProfile(){
                            let url = 'http://health.us-east-2.elasticbeanstalk.com/insomnia/v1/patient/accessid';
                            let authToken = window.localStorage.getItem("patientToken");
                            //alert(authToken);
                            $.ajax({
                                url: url,
                                type: 'GET',
                                headers: {
                                    'Content-Type': 'application/json', 
                                    'Accept': '*/*',
                                    'Authorization': 'Bearer '+ authToken
                                },
                                success: function(result){
                                    console.log(result);
                                    var arrayLength = 0; var trialNo = result.trialType;
                                    var medicationCurrentObj = ''; var medicationPreviousObj = '';
                                    var currentDate = ''; var otherMedCurrentObj = '';
                                    var currentID = ''; var otherMedPreviousObj = '';
                                    var prevDate = ''; var sleepDariesCurrent = ''; 
                                    var prevID = '';  var sleepDiaryPrevious = '';
                                    window.localStorage.setItem("patientsID", result.id);
                                    window.localStorage.setItem("patientLastName", result.lastName);
                                    window.localStorage.setItem("patientFirstName", result.firstName);
                                    window.localStorage.setItem("patientPhone", result.phoneNumber);
                                    window.localStorage.setItem("patientEmail", result.email);
                                    window.localStorage.setItem("trialNo", trialNo);
                                    console.log(window.localStorage.getItem("patientsID"));

                                    $.each(result.sleepDiaries, function(i, def) {
                                        if(arrayLength == 0){
                                            currentDate = def.date_Created;
                                            currentID = def.id;
                                            if(trialNo == 2){
                                                medicationCurrentObj = JSON.stringify(def.medications);
                                            }
                                            sleepDariesCurrent = JSON.stringify(def);
                                            otherMedCurrentObj = JSON.stringify(def.othermedications);
                                        } else if(arrayLength == 1){
                                            prevDate = def.date_Created;
                                            prevID = def.id;
                                            if(trialNo == 2){
                                                medicationPreviousObj = JSON.stringify(def.medications);
                                            }
                                            sleepDiaryPrevious = JSON.stringify(def);
                                            otherMedPreviousObj = JSON.stringify(def.othermedications);
                                        }
                                        arrayLength += 1;
                                    });

                                    var currentDate2 = currentDate.split("T", 1)

                                    var prevDate2 = prevDate.split("T", 1)
                                    //window.localStorage.setItem("prevDate", prevDate);
                                    window.localStorage.setItem("arrayLength", arrayLength);
                                    if(arrayLength == 1){
                                        window.localStorage.setItem("currentDate", currentDate2); 
                                        window.localStorage.setItem("currentDateUnformatted", currentDate);
                                        window.localStorage.setItem("currentID", currentID);
                                        window.localStorage.setItem("medicationCurrentObj", medicationCurrentObj);
                                        window.localStorage.setItem("sleepDariesCurrent", sleepDariesCurrent);
                                        window.localStorage.setItem("otherMedCurrentObj", otherMedCurrentObj);
                                        document.getElementById('prevLink').style.display = 'none';
                                    }else{
                                        var dateOne = new Date(currentDate2); //Year, Month, Date    
                                        var dateTwo = new Date(prevDate2); //Year, Month, Date 
                                        if (dateOne > dateTwo) {    
                                            window.localStorage.setItem("currentDate", currentDate2); 
                                            window.localStorage.setItem("prevDate", prevDate2);  
                                            window.localStorage.setItem("currentDateUnformatted", currentDate);
                                            window.localStorage.setItem("currentID", currentID);
                                            window.localStorage.setItem("sleepDariesCurrent", sleepDariesCurrent);
                                            window.localStorage.setItem("sleepDiaryPrevious", sleepDiaryPrevious);
                                            window.localStorage.setItem("medicationCurrentObj", medicationCurrentObj);
                                            window.localStorage.setItem("otherMedCurrentObj", otherMedCurrentObj);
                                            window.localStorage.setItem("prevID", prevID);
                                            window.localStorage.setItem("prevDateUnformatted", prevDate);  
                                            window.localStorage.setItem("medicationPreviousObj", medicationPreviousObj);
                                            window.localStorage.setItem("otherMedPreviousObj", otherMedPreviousObj);
                                        }else {    
                                            window.localStorage.setItem("currentDate", prevDate2); 
                                            window.localStorage.setItem("prevDate", currentDate2);  
                                            window.localStorage.setItem("currentDateUnformatted", prevDate);
                                            window.localStorage.setItem("currentID", prevID);
                                            window.localStorage.setItem("sleepDariesCurrent", sleepDiaryPrevious);
                                            window.localStorage.setItem("sleepDiaryPrevious", sleepDariesCurrent);
                                            window.localStorage.setItem("medicationCurrentObj", medicationPreviousObj);
                                            window.localStorage.setItem("otherMedCurrentObj", otherMedPreviousObj);
                                            window.localStorage.setItem("prevID", currentID);
                                            window.localStorage.setItem("prevDateUnformatted", currentDate); 
                                            window.localStorage.setItem("medicationPreviousObj", medicationCurrentObj);
                                            window.localStorage.setItem("otherMedPreviousObj", otherMedCurrentObj);
                                        }  
                                    }

                                      
                                }, 
                                error: function(msg){
                                    console.log("Loading Patients details failed");
                                    sweetAlert("Failed To Load Account Details!!","Your account details was not able to load. Please login again","error");
                                    window.location.href = "index.html";
                                }
                            });
                        }
    
          </script>

</head>

<body>

    <!--*******************
        Preloader start
    ********************-->
    <div id="preloader">
        <div class="loader">
            <svg class="circular" viewBox="25 25 50 50">
                <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="3" stroke-miterlimit="10" />
            </svg>
        </div>
    </div>
    <!--*******************
        Preloader end
    ********************-->

    
    <!--**********************************
        Main wrapper start
    ***********************************-->
    <div id="main-wrapper">

        <!--**********************************
            Nav header start
        ***********************************-->
        <div class="nav-header">
            <div class="brand-logo">
                <a href="patient-dashboard.html">
                    <b class="logo-abbr">
                        <!-- <img src="images/logo.png" alt="">  -->
                    </b>
                    <span class="logo-compact">
                        <!-- <img src="./images/logo-compact.png" alt=""> -->
                    </span>
                    <span class="brand-title">
                        <!-- <img src="images/logo-text.png" alt=""> -->
                    </span>
                </a>
            </div>
        </div>
        <!--**********************************
            Nav header end
        ***********************************-->

        <!--**********************************
            Header start
        ***********************************-->
        <div class="header">    
            <div class="header-content clearfix">
                
                <div class="nav-control">
                    <div class="hamburger">
                        <span class="toggle-icon"><i class="icon-menu"></i></span>
                    </div>
                </div>

                <div class="header-right">
                    <ul class="clearfix">
                        
                        <li class="icons dropdown">
                            <div class="user-img c-pointer position-relative"   data-toggle="dropdown">
                                <span class="activity active"></span>
                                <img src="images/user/form-user.png" height="40" width="40" alt="">
                            </div>
                            <div class="drop-down dropdown-profile animated fadeIn dropdown-menu">
                                <div class="dropdown-content-body">
                                    <ul>
                                        <li>
                                            <a href="patient-profile.html"><i class="icon-user"></i> <span>Profile</span></a>
                                        </li>

                                        <li><a href="index.html" onclick="logout();"><i class="icon-key"></i> <span>Logout</span></a></li>
                                    </ul>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!--**********************************
            Header end ti-comment-alt
        ***********************************-->

        <!--**********************************
            Sidebar start
        ***********************************-->
        <div class="nk-sidebar">           
            <div class="nk-nav-scroll">
                <ul class="metismenu" id="menu">
                    <li class="nav-label">Patient Dashboard</li>
                    <!-- <li>
                        <a class="has-arrow" href="javascript:void()" aria-expanded="false">
                            <i class="icon-grid menu-icon"></i><span class="nav-text">Dashboard</span>
                        </a>
                        <ul aria-expanded="false">
                            <li><a href="./index.html">Home</a></li>
                            <li><a href="./index-2.html">Home 2</a></li>
                        </ul>
                    </li> -->

                    <li class="mega-menu mega-menu-sm">
                        <a class="has-arrow" href="javascript:void()" aria-expanded="false">
                            <i class="icon-user menu-icon"></i><span class="nav-text">Patient Profile</span>
                        </a>
                        <ul aria-expanded="false">
                            <li><a href="./patient-profile.html">My Profile</a></li>
                        </ul>
                    </li>

                    <li class="mega-menu mega-menu-sm">
                        <a class="has-arrow" href="javascript:void()" aria-expanded="false">
                            <i class="icon-note menu-icon"></i><span class="nav-text">Sleep Diary</span>
                        </a>
                        <ul aria-expanded="false" id="sleepLink">
                            <li><a href="./sleep-diary.html" style="display: none;"></a></li>
                            <li><a href="./sleep-diary.html" style="display: none;"></a></li>
                        </ul>
                    </li>

                    <li class="mega-menu mega-menu-sm spClock" style="display: none;">
                        <a class="has-arrow" href="javascript:void()" aria-expanded="false">
                            <i class="icon-speedometer menu-icon"></i><span class="nav-text">Sleep Clock</span>
                        </a>
                        <ul aria-expanded="false">
                            <li><a href="./patient-sleep-clock.html">My Sleep Clock</a></li>
                        </ul>
                    </li>

                    <li class="mega-menu mega-menu-sm">
                        <a class="has-arrow" href="javascript:void()" aria-expanded="false">
                            <i class="icon-graph menu-icon"></i><span class="nav-text">Sleep Report</span>
                        </a>
                        <ul aria-expanded="false">
                            <li><a href="./patient-sleep-report.html">My Sleep Report</a></li>
                        </ul>
                    </li>

                    <!-- <li class="mega-menu mega-menu-sm">
                        <a class="has-arrow" href="javascript:void()" aria-expanded="false">
                            <i class="icon-screen-tablet menu-icon"></i><span class="nav-text">Sleep Medication</span>
                        </a>
                        <ul aria-expanded="false">
                            <li><a href="./sleep-medication.html">My Sleep Medication</a></li>
                        </ul>
                    </li> -->

                    <li class="mega-menu mega-menu-sm">
                        <a class="has-arrow" href="javascript:void()" aria-expanded="false">
                            <i class="icon-notebook menu-icon"></i><span class="nav-text">Task & Progress</span>
                        </a>
                        <ul aria-expanded="false">
                            <li><a href="./task-list.html">My Task List</a></li>
                            <li><a href="./program-content.html">My Progress</a></li>
                        </ul>
                    </li>

                    <!-- <li class="mega-menu mega-menu-sm">
                        <a class="has-arrow" href="javascript:void()" aria-expanded="false">
                            <i class="icon-user menu-icon"></i><span class="nav-text">User Guide</span>
                        </a>
                        <ul aria-expanded="false">
                            <li><a href="./patient-profile.html">My User Guide</a></li>
                        </ul>
                    </li> -->

                    <li class="mega-menu mega-menu-sm">
                        <a class="has-arrow" href="javascript:void()" aria-expanded="false">
                            <i class="icon-envelope menu-icon"></i><span class="nav-text">Contact Us</span>
                        </a>
                        <ul aria-expanded="false">
                            <li><a href="./voluntary-withdrawal.html">Voluntory Withdrawal</a></li>
                            <li><a href="./feedback.html">Feedback</a></li>
                        </ul>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
        <!--**********************************
            Sidebar end
        ***********************************-->

        <!--**********************************
            Content body start
        ***********************************-->
        <div class="content-body">

            <div class="container-fluid mt-3">
                <div class="row">
                    <!-- <div class="col-lg-12 col-md-12 col-sm-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title">SLEEP DIARY</h4>
                                <h5 class="mt-3">Completed <span class="float-right">10%</span></h5>
                                <div class="progress" style="height: 9px">
                                    <div class="progress-bar bg-danger wow  progress-" style="width: 10%;" role="progressbar"><span class="sr-only">60% Complete</span>
                                    </div>
                                </div>
                                
                            </div>
                        </div>

                    </div> -->
                    
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title colorPrimary">Baseline Sleep Diary</h4><hr>
                                <div class="justifyDiv">
                                    The next step is to begin tracking your sleep patterns. Please take a few minutes to fill out a sleep diary each morning for the next 2 weeks. This lets us know your starting point. If you forget to record your answers one morning, you can go back and fill them in up to a day later. 
                                </div><br>

                                <div>
                                    <label class="lblQuestion colorSubHeader" style="margin-bottom: 0px;">Sleep diary instructions:</label>
                                </div>
                                <div>
                                    The sleep diary is very brief. It should only take a few minutes to complete. 
                                </div>
                                <div class="justifyDiv">
                                    If you don’t know the exact times, record your best guess. 
                                </div>
                                <div class="consentInfoBody">
                                    •	Record the time you got into bed. 
                                </div>
                                <div class="consentInfoBody">
                                    •	Record the time you began to try to fall asleep. 
                                </div>
                                <div class="consentInfoBody">
                                    •	Estimate the time when you fell asleep. 
                                </div>
                                <div class="consentInfoBody">
                                    •	Record how many times you woke up during the night. 
                                </div>

                                <div class="consentInfoBody">
                                    •	Record how long you were awake each time. 
                                </div>
                                <div class="consentInfoBody">
                                    •	Record the time you woke up and stayed awake. 
                                </div>
                                <div class="consentInfoBody">
                                    •	Record the time you got out of bed to start your day. This should be after your final awakening. 
                                </div>
                                <div class="consentInfoBody">
                                    •	Rate the overall quality of your sleep.
                                </div>
                                <div class="consentInfoBody">
                                    •	Note any medications or other sleep aids taken before going to bed. 
                                </div>

                                <div class="justifyDiv">
                                    Please fill out a sleep diary each day. It is best to do this as soon as you get out of bed so that you don’t forget. You can also use the Medication log at any time to record any medications you are taking.
                                </div>

                                <div class="row">
                                    <div class="col-md-6 col-sm-12 sleepDiv" id="todayLink">
                                        <a href="sleep-diary.html" class="txt1">
                                            <strong>Complete today’s sleep diary</strong>
                                        </a>
                                    </div>
                                    <div class="col-md-6 col-sm-12 sleepDiv" id="prevLink">
                                        <a href="sleep-diary.html" class="txt1">
                                            <strong>Complete yesterday’s sleep diary</strong>
                                        </a>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>

                </div>

               
                    
            </div>
            <!-- #/ container -->
        </div>
        <!--**********************************
            Content body end
        ***********************************-->
        
        
        <!--**********************************
            Footer start
        ***********************************-->
        <div class="footer">
            <div class="copyright">
                <p>Copyright &copy; Designed & Developed by <a href="https://themeforest.net/user/quixlab">Health enSuite Research Team</a> 2020</p>
            </div>
        </div>
        <!--**********************************
            Footer end
        ***********************************-->
    </div>
    <!--**********************************
        Main wrapper end
    ***********************************-->

    <!--**********************************
        Scripts
    ***********************************-->
    <script src="plugins/common/common.min.js"></script>
    <script src="js/custom.min.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/gleek.js"></script>
    <script src="js/styleSwitcher.js"></script>

    <!-- Chartjs -->
    <script src="./plugins/chart.js/Chart.bundle.min.js"></script>
    <!-- Circle progress -->
    <script src="./plugins/circle-progress/circle-progress.min.js"></script>
    <!-- Datamap -->
    <script src="./plugins/d3v3/index.js"></script>
    <script src="./plugins/topojson/topojson.min.js"></script>
    <script src="./plugins/datamaps/datamaps.world.min.js"></script>
    <!-- Morrisjs -->
    <script src="./plugins/raphael/raphael.min.js"></script>
    <script src="./plugins/morris/morris.min.js"></script>
    <!-- Pignose Calender -->
    <script src="./plugins/moment/moment.min.js"></script>
    <script src="./plugins/pg-calendar/js/pignose.calendar.min.js"></script>
    <!-- ChartistJS -->
    <script src="./plugins/chartist/js/chartist.min.js"></script>
    <script src="./plugins/chartist-plugin-tooltips/js/chartist-plugin-tooltip.min.js"></script>

    <script src="js/MoreFunction.js"></script>
    <script src="js/sleepDairyInit.js"></script>
    <script src="./plugins/sweetalert/js/sweetalert.min.js"></script>

    <script language = "javascript">
        function getAllLinks(dayValue){
                        var dayNumber1 = 0; var dayNumber2 = 0; 
                        var galLinks = document.getElementById('sleepLink');
                        var anchors = galLinks.getElementsByTagName('a');
                        for (i = 0; i < anchors.length; i++) {  
                            var thisLink = anchors[i];
                            
                            if(dayValue == 1){
                                thisLink.style.display = 'block';
                                thisLink.innerHTML = window.localStorage.getItem("currentDate");
                                return;
                            }
                            
                            dayNumber1 += 1;
                            if(dayNumber1 == (dayValue - 1)){
                                thisLink.style.display = 'block';
                                thisLink.innerHTML = window.localStorage.getItem("currentDate");
                            }
                            
                            if(dayNumber1 == dayValue){
                                thisLink.style.display = 'block';
                                thisLink.innerHTML = window.localStorage.getItem("prevDate");
                                return;
                            }
                        }
                    }

                    $(document).ready(function () {
                        var theArrayLength = window.localStorage.getItem("arrayLength");
                        getAllLinks(theArrayLength); 
                    });
    </script>

</body>

</html>